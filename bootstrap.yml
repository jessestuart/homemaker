---
- name: Bootstrap the environment -- install dependencies and set hostname.
  hosts: all
  become: yes
  gather_facts: yes
  tags: dependencies
  vars_files:
    - host_vars/main.yml
  roles:
    - base

# Create ssh users and revoke old root and default user access
# from a newly-provisioned machine.
#
# DANGER -- this is destructive. Make sure you want to totally bootstrap
# a new ssh environment.
- name: Create SSH users.
  hosts: all
  become: yes
  tags: ssh
  roles:
    - ssh-users

- name: Remove root access & harden box security.
  hosts: all
  become: yes
  tags: opsec
  roles:
    - opsec

- name: Set up NTP.
  hosts: all
  become: yes
  roles:
    - bennojoy.ntp

- name: Install docker.
  hosts: all
  tags: docker
  become: yes
  roles:
    - geerlingguy.docker

- name: Install pip.
  hosts: all
  tags: pip
  become: yes
  roles:
    - geerlingguy.pip

- name: Install tmux.
  hosts: all
  become: yes
  vars_files:
    - 'host_vars/main.yml'
  tags:
    - deps
    - tmux
  roles:
    - tmux

- name: Install zsh and prezto.
  hosts: all
  become: yes
  tags:
    - deps
    - zsh
  vars_files:
    - 'host_vars/main.yml'
  tasks:
    - name: Install zsh.
      become: yes
      yum: name=zsh state=latest
    - name: Install Prezto.
      become: yes
      become_user: "{{ user }}"
      git:
        repo: https://github.com/sorin-ionescu/prezto
        dest: "$HOME/.zprezto"
        recursive: yes
        force: yes
    - name: Set default shell.
      become: yes
      user:
        name: "{{ user }}"
        shell: /bin/zsh

- name: Make yourself at home.
  gather_facts: yes
  hosts: all
  become: yes
  vars_files:
    - 'host_vars/main.yml'
  tags: homemaker
  roles:
    - homemaker
