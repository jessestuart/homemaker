---
- name: Install the nice things.
  yum:
    name: "{{ item }}"
    state: latest
    # update_cache: yes
  with_items:
    - go
    - mosh
    - neovim
    - nodejs
    - rsync

- name: Start docker daemon at boot.
  systemd:
    name: docker
    enabled: yes
  # shell: rc-update add docker boot

- name: Update PATH.
  tags: rcm
  lineinfile: >
    dest=/etc/environment
    state=present
    backrefs=yes
    regexp='PATH=(["]*)((?!.*?{{ item }}).*?)(["]*)$'
    line="PATH=\1\2:{{ item }}\3"
  with_items:
    - /usr/local/bin

- name: Determine if RCM is installed.
  shell: if (hash lsrc &>/dev/null); then echo 1; else echo 0; fi
  register: rcm_installed
  ignore_errors: yes
  tags: rcm

- name: Install Thoughtbot's RCM to manage dotfiles.
  tags: rcm
  become_user: "{{ user }}"
  get_url:
    url: https://thoughtbot.github.io/rcm/dist/rcm-1.3.1.tar.gz
    dest: "$HOME"
  # when: not rcm_installed

- name: foo
  become: yes
  become_user: "{{ user }}"
  tags: rcm
  shell:
    tar -xvf "$HOME/rcm-1.3.1.tar.gz" && \
    cd rcm-1.3.1 && \
    ./configure && \
    make && \
    sudo make install
  # when: not rcm_installed

# - name: Determine if dotfiles directory exists.
#   become_user: "{{ user }}"
#   shell: ls "$HOME/dotfiles" &>/dev/null
#   register: dotfiles_cloned
#   ignore_errors: yes

- name: Pull dotfiles.
  become: yes
  become_user: "{{ user }}"
  tags: rcm
  git:
    repo: https://github.com/jessestuart/dotfiles
    dest: "$HOME/dotfiles"
  # when: not dotfiles_cloned